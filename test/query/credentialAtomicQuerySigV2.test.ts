import {describe} from "mocha";

const path = require("path");
const wasmTester = require("circom_tester").wasm;

export {};

describe("Test credentialAtomicQuerySigV2.circom", function() {

    this.timeout(600000);

    let circuit;

    before(async () => {
        circuit = await wasmTester(
            path.join(__dirname, "../../circuits/offchain", "credentialAtomicQuerySigV2.circom"),
            {
                output: path.join(__dirname, "circuits", "build"),
                recompile: true,
                reduceConstraints: false,
            },
        );

    });

    after(async () => {
        circuit.release()
    })

    it("Genesis state: claim issued on userID credentialAtomicQuerySigV2Test", async () => {
        // inputs MUST be generated by GO-CIRCUITS library https://github.com/iden3/go-circuits (using corresponding test)
        const inputs = {
            userGenesisID: "24357338057394103910029868244681596615276666879950910837900400354886746113",
            nonce: "0",
            claimSubjectProfileNonce: "0",
            issuerID: "24357338057394103910029868244681596615276666879950910837900400354886746113",
            issuerClaim: [
                "3583233690122716044519380227940806650830",
                "24357338057394103910029868244681596615276666879950910837900400354886746113",
                "17568057213828477233507447080689055308823020388972334380526849356111335110900",
                "0",
                "30803922965249841627828060170",
                "0",
                "0",
                "0",
            ],
            issuerClaimNonRevClaimsTreeRoot: "16935233905999379395228879484629933212061337894505747058350106225580401780334",
            issuerClaimNonRevRevTreeRoot: "0",
            issuerClaimNonRevRootsTreeRoot: "0",
            issuerClaimNonRevState: "18038855432424775233659896904370825175764119936950028950189276486279006981491",
            issuerClaimNonRevMtp: [
                "0",
                "0",
                "0",
                "0",
                "0",
                "0",
                "0",
                "0",
                "0",
                "0",
                "0",
                "0",
                "0",
                "0",
                "0",
                "0",
                "0",
                "0",
                "0",
                "0",
                "0",
                "0",
                "0",
                "0",
                "0",
                "0",
                "0",
                "0",
                "0",
                "0",
                "0",
                "0",
            ],
            issuerClaimNonRevMtpAuxHi: "0",
            issuerClaimNonRevMtpAuxHv: "0",
            issuerClaimNonRevMtpNoAux: "1",
            claimSchema: "180410020913331409885634153623124536270",
            issuerClaimSignatureR8x: "3017397964988671065300729044646157787094963425063948585835659398590899755539",
            issuerClaimSignatureR8y: "8933147283525203493792096378411252775992322346613402903323345179819059106328",
            issuerClaimSignatureS: "2328449226267223092529649688730159507357166811782711131160124115135840509586",
            issuerAuthClaim: [
                "304427537360709784173770334266246861770",
                "0",
                "4720763745722683616702324599137259461509439547324750011830105416383780791263",
                "4844030361230692908091131578688419341633213823133966379083981236400104720538",
                "16547485850637761685",
                "0",
                "0",
                "0",
            ],
            issuerAuthClaimMtp: [
                "0",
                "0",
                "0",
                "0",
                "0",
                "0",
                "0",
                "0",
                "0",
                "0",
                "0",
                "0",
                "0",
                "0",
                "0",
                "0",
                "0",
                "0",
                "0",
                "0",
                "0",
                "0",
                "0",
                "0",
                "0",
                "0",
                "0",
                "0",
                "0",
                "0",
                "0",
                "0",
            ],
            issuerAuthClaimNonRevMtp: [
                "0",
                "0",
                "0",
                "0",
                "0",
                "0",
                "0",
                "0",
                "0",
                "0",
                "0",
                "0",
                "0",
                "0",
                "0",
                "0",
                "0",
                "0",
                "0",
                "0",
                "0",
                "0",
                "0",
                "0",
                "0",
                "0",
                "0",
                "0",
                "0",
                "0",
                "0",
                "0",
            ],
            issuerAuthClaimNonRevMtpAuxHi: "0",
            issuerAuthClaimNonRevMtpAuxHv: "0",
            issuerAuthClaimNonRevMtpNoAux: "1",
            issuerAuthClaimsTreeRoot: "16935233905999379395228879484629933212061337894505747058350106225580401780334",
            issuerAuthRevTreeRoot: "0",
            issuerAuthRootsTreeRoot: "0",
            claimPathNotExists: "0",
            claimPathMtp: [
                "5559250731000753554753485016695600829384855452867544273344893815961938985436",
                "20222899544143787877985297439625828822272100269106711904511119118819809140477",
                "14730426618666280941604039095550905490156541514901979358549599762282042588641",
                "20497288520738821800886677250569208588689763166335933087499619993954968899866",
                "3295720551404287572425718873751040314503774617833462052445584373469655789999",
                "796356776410152646380783209242693344675665178494017735650545708722024766291",
                "0",
                "0",
                "0",
                "0",
                "0",
                "0",
                "0",
                "0",
                "0",
                "0",
                "0",
                "0",
                "0",
                "0",
                "0",
                "0",
                "0",
                "0",
                "0",
                "0",
                "0",
                "0",
                "0",
                "0",
                "0",
                "0",
            ],
            claimPathMtpNoAux: "0",
            claimPathMtpAuxHi: "0",
            claimPathMtpAuxHv: "0",
            claimPathKey: "8566939875427719562376598811066985304309117528846759529734201066483458512800",
            claimPathValue: "1420070400000000000",
            operator: 1,
            slotIndex: 2,
            timestamp: "1642074362",
            value: [
                "1420070400000000000",
                "0",
                "0",
                "0",
                "0",
                "0",
                "0",
                "0",
                "0",
                "0",
                "0",
                "0",
                "0",
                "0",
                "0",
                "0",
                "0",
                "0",
                "0",
                "0",
                "0",
                "0",
                "0",
                "0",
                "0",
                "0",
                "0",
                "0",
                "0",
                "0",
                "0",
                "0",
                "0",
                "0",
                "0",
                "0",
                "0",
                "0",
                "0",
                "0",
                "0",
                "0",
                "0",
                "0",
                "0",
                "0",
                "0",
                "0",
                "0",
                "0",
                "0",
                "0",
                "0",
                "0",
                "0",
                "0",
                "0",
                "0",
                "0",
                "0",
                "0",
                "0",
                "0",
                "0",
            ],
        }

        const expOut = {
            userID: "24357338057394103910029868244681596615276666879950910837900400354886746113",
            issuerID: "24357338057394103910029868244681596615276666879950910837900400354886746113",
            issuerAuthState: "18038855432424775233659896904370825175764119936950028950189276486279006981491",
            issuerClaimNonRevState: "18038855432424775233659896904370825175764119936950028950189276486279006981491",
            claimSchema: "180410020913331409885634153623124536270",
            slotIndex: "2",
            operator: "1",
            value: ["1420070400000000000", "0", "0", "0", "0", "0", "0", "0", "0", "0", "0", "0", "0", "0", "0", "0", "0", "0", "0", "0", "0", "0", "0", "0", "0", "0", "0", "0", "0", "0", "0", "0", "0", "0", "0", "0", "0", "0", "0", "0", "0", "0", "0", "0", "0", "0", "0", "0", "0", "0", "0", "0", "0", "0", "0", "0", "0", "0", "0", "0", "0", "0", "0", "0"],
            timestamp: "1642074362",
        }
        const w = await circuit.calculateWitness(inputs, true);
        await circuit.checkConstraints(w);
        await circuit.assertOut(w, expOut);
    });

    // it("Claim issued on ProfileID", async () => {
    //     const inputs = {
    //         userGenesisID: "24357338057394103910029868244681596615276666879950910837900400354886746113",
    //         nonce: "0",
    //         claimSubjectProfileNonce: "10",
    //         issuerID: "24357338057394103910029868244681596615276666879950910837900400354886746113",
    //         issuerClaim: ["3583233690122716044519380227940806650830", "16501380676610282756331962130170908325950918404081458092270009074630918145", "10", "0", "30803922965249841627828060161", "0", "0", "0"],
    //         issuerClaimNonRevClaimsTreeRoot: "16935233905999379395228879484629933212061337894505747058350106225580401780334",
    //         issuerClaimNonRevRevTreeRoot: "0",
    //         issuerClaimNonRevRootsTreeRoot: "0",
    //         issuerClaimNonRevState: "18038855432424775233659896904370825175764119936950028950189276486279006981491",
    //         issuerClaimNonRevMtp: ["0", "0", "0", "0", "0", "0", "0", "0", "0", "0", "0", "0", "0", "0", "0", "0", "0", "0", "0", "0", "0", "0", "0", "0", "0", "0", "0", "0", "0", "0", "0", "0"],
    //         issuerClaimNonRevMtpAuxHi: "0",
    //         issuerClaimNonRevMtpAuxHv: "0",
    //         issuerClaimNonRevMtpNoAux: "1",
    //         claimSchema: "180410020913331409885634153623124536270",
    //         issuerClaimSignatureR8x: "12074640799585694194825621308901989697901811309648903617181490888186328073852",
    //         issuerClaimSignatureR8y: "20013348869823451001409494894355361541892711372923295656716123209472931908138",
    //         issuerClaimSignatureS: "1699151003214844225942254853176295275394450805508615714887829081471506584000",
    //         issuerAuthClaim: ["304427537360709784173770334266246861770", "0", "4720763745722683616702324599137259461509439547324750011830105416383780791263", "4844030361230692908091131578688419341633213823133966379083981236400104720538", "16547485850637761685", "0", "0", "0"],
    //         issuerAuthClaimMtp: ["0", "0", "0", "0", "0", "0", "0", "0", "0", "0", "0", "0", "0", "0", "0", "0", "0", "0", "0", "0", "0", "0", "0", "0", "0", "0", "0", "0", "0", "0", "0", "0"],
    //         issuerAuthClaimNonRevMtp: ["0", "0", "0", "0", "0", "0", "0", "0", "0", "0", "0", "0", "0", "0", "0", "0", "0", "0", "0", "0", "0", "0", "0", "0", "0", "0", "0", "0", "0", "0", "0", "0"],
    //         issuerAuthClaimNonRevMtpAuxHi: "0",
    //         issuerAuthClaimNonRevMtpAuxHv: "0",
    //         issuerAuthClaimNonRevMtpNoAux: "1",
    //         issuerAuthClaimsTreeRoot: "16935233905999379395228879484629933212061337894505747058350106225580401780334",
    //         issuerAuthRevTreeRoot: "0",
    //         issuerAuthRootsTreeRoot: "0",
    //         operator: 1,
    //         slotIndex: 2,
    //         timestamp: "1642074362",
    //         value: ["10", "0", "0", "0", "0", "0", "0", "0", "0", "0", "0", "0", "0", "0", "0", "0", "0", "0", "0", "0", "0", "0", "0", "0", "0", "0", "0", "0", "0", "0", "0", "0", "0", "0", "0", "0", "0", "0", "0", "0", "0", "0", "0", "0", "0", "0", "0", "0", "0", "0", "0", "0", "0", "0", "0", "0", "0", "0", "0", "0", "0", "0", "0", "0"],
    //     }
    //
    //     const expOut = {
    //         userID: "24357338057394103910029868244681596615276666879950910837900400354886746113",
    //     }
    //     const w = await circuit.calculateWitness(inputs, true);
    //     await circuit.checkConstraints(w);
    //     await circuit.assertOut(w, expOut);
    //
    // });

    // it("NOT Genesis state: credentialAtomicQuerySigV2Test", async () => {
    //   // inputs MUST be generated by GO-CIRCUITS library https://github.com/iden3/go-circuits (using corresponding test)
    //   const inputs = {
    //     userAuthClaim: ["304427537360709784173770334266246861770", "0", "17640206035128972995519606214765283372613874593503528180869261482403155458945", "20634138280259599560273310290025659992320584624461316485434108770067472477956", "15930428023331155902", "0", "0", "0"],
    //     userAuthClaimMtp: ["0", "0", "1243904711429961858774220647610724273798918457991486031567244100767259239747", "0", "0", "0", "0", "0", "0", "0", "0", "0", "0", "0", "0", "0", "0", "0", "0", "0", "0", "0", "0", "0", "0", "0", "0", "0", "0", "0", "0", "0"],
    //     userAuthClaimNonRevMtp: ["0", "0", "0", "0", "0", "0", "0", "0", "0", "0", "0", "0", "0", "0", "0", "0", "0", "0", "0", "0", "0", "0", "0", "0", "0", "0", "0", "0", "0", "0", "0", "0"],
    //     userAuthClaimNonRevMtpAuxHi: "0",
    //     userAuthClaimNonRevMtpAuxHv: "0",
    //     userAuthClaimNonRevMtpNoAux: "1",
    //     userClaimsTreeRoot: "3325296375493109531775738970103865437471502880293182874312109748701010548081",
    //     userState: "21556156816336611928260850205358242317673071374695788694657164635542250181506",
    //     // tslint:disable-next-line:object-literal-sort-keys
    //     userRevTreeRoot: "0",
    //     userRootsTreeRoot: "0",
    //     userGenesisID: "379949150130214723420589610911161895495647789006649785264738141299135414272",
    //     challenge: "1",
    //     challengeSignatureR8x: "8553678144208642175027223770335048072652078621216414881653012537434846327449",
    //     challengeSignatureR8y: "5507837342589329113352496188906367161790372084365285966741761856353367255709",
    //     challengeSignatureS: "2093461910575977345603199789919760192811763972089699387324401771367839603655",
    //     issuerClaim: ["3583233690122716044519380227940806650830", "379949150130214723420589610911161895495647789006649785264738141299135414272", "10", "0", "30803922965249841627828060161", "0", "0", "0"],
    //     issuerClaimNonRevClaimsTreeRoot: "3077200351284676204723270374054827783313480677490603169533924119235084704890",
    //     issuerClaimNonRevRevTreeRoot: "0",
    //     issuerClaimNonRevRootsTreeRoot: "0",
    //     issuerClaimNonRevState: "18605292738057394742004097311192572049290380262377486632479765119429313092475",
    //     issuerClaimNonRevMtp: ["0", "0", "0", "0", "0", "0", "0", "0", "0", "0", "0", "0", "0", "0", "0", "0", "0", "0", "0", "0", "0", "0", "0", "0", "0", "0", "0", "0", "0", "0", "0", "0"],
    //     issuerClaimNonRevMtpAuxHi: "0",
    //     issuerClaimNonRevMtpAuxHv: "0",
    //     issuerClaimNonRevMtpNoAux: "1",
    //     claimSchema: "180410020913331409885634153623124536270",
    //     issuerID: "26599707002460144379092755370384635496563807452878989192352627271768342528",
    //     operator: 1,
    //     slotIndex: 2,
    //     timestamp: "1642074362",
    //     value: ["10", "0", "0", "0", "0", "0", "0", "0", "0", "0", "0", "0", "0", "0", "0", "0", "0", "0", "0", "0", "0", "0", "0", "0", "0", "0", "0", "0", "0", "0", "0", "0", "0", "0", "0", "0", "0", "0", "0", "0", "0", "0", "0", "0", "0", "0", "0", "0", "0", "0", "0", "0", "0", "0", "0", "0", "0", "0", "0", "0", "0", "0", "0", "0"],
    //     issuerClaimSignatureR8x: "18625305647089498634672127449050652473073470525382360069529718632627474482386",
    //     issuerClaimSignatureR8y: "14539700345423181413201048131770723125531044953576671601029329833956725811279",
    //     issuerClaimSignatureS: "772934080142423067561028786350670095248312416624185973552603152377549415467",
    //     issuerAuthClaim: ["304427537360709784173770334266246861770", "0", "9582165609074695838007712438814613121302719752874385708394134542816240804696", "18271435592817415588213874506882839610978320325722319742324814767882756910515", "11203087622270641253", "0", "0", "0"],
    //     // tslint:disable-next-line:max-line-length
    //     issuerAuthClaimMtp: ["0", "0", "0", "0", "0", "0", "0", "0", "0", "0", "0", "0", "0", "0", "0", "0", "0", "0", "0", "0", "0", "0", "0", "0", "0", "0", "0", "0", "0", "0", "0", "0"],
    //     issuerAuthClaimNonRevMtp: ["0", "0", "0", "0", "0", "0", "0", "0", "0", "0", "0", "0", "0", "0", "0", "0", "0", "0", "0", "0", "0", "0", "0", "0", "0", "0", "0", "0", "0", "0", "0", "0"],
    //     issuerAuthClaimNonRevMtpAuxHi: "0",
    //     issuerAuthClaimNonRevMtpAuxHv: "0",
    //     issuerAuthClaimNonRevMtpNoAux: "1",
    //     issuerAuthClaimsTreeRoot: "18337129644116656308842422695567930755039142442806278977230099338026575870840",
    //     issuerAuthRevTreeRoot: "0",
    //     issuerAuthRootsTreeRoot: "0",
    //     nonce: "123456789",
    //     globalSmtMtp: ["0", "2740674427662457332835454792145677734479634481325332115749498841888350110548", "19991091798052235227442886829713443191817461077589875647331508266325270343516", "0", "0", "0", "0", "0", "0", "0", "0", "0", "0", "0", "0", "0", "0", "0", "0", "0", "0", "0", "0", "0", "0", "0", "0", "0", "0", "0", "0", "0"],
    //     globalSmtRoot: "2527369248886058159298190241228260543545233125629989424050431010562778308348",
    //     globalSmtMtpAuxHi: "0",
    //     globalSmtMtpAuxHv: "0",
    //     globalSmtMtpNoAux: "0",
    //   }
    //
    //   const expOut = {
    //     globalSmtRoot: "2527369248886058159298190241228260543545233125629989424050431010562778308348",
    //     // tslint:disable-next-line:object-literal-sort-keys
    //     userID: "18968116468485570865854580659399634645721780236139322781445564960051610308120",
    //     issuerID: "26599707002460144379092755370384635496563807452878989192352627271768342528",
    //     issuerAuthState: "6317996369756476782464660619835940615734517981889733696047139451453239145426",
    //     issuerClaimNonRevState: "18605292738057394742004097311192572049290380262377486632479765119429313092475",
    //     challenge: "1",
    //     claimSchema: "180410020913331409885634153623124536270",
    //     slotIndex: "2",
    //     operator: "1",
    //     value: ["10", "0", "0", "0", "0", "0", "0", "0", "0", "0", "0", "0", "0", "0", "0", "0", "0", "0", "0", "0", "0", "0", "0", "0", "0", "0", "0", "0", "0", "0", "0", "0", "0", "0", "0", "0", "0", "0", "0", "0", "0", "0", "0", "0", "0", "0", "0", "0", "0", "0", "0", "0", "0", "0", "0", "0", "0", "0", "0", "0", "0", "0", "0", "0"],
    //     timestamp: "1642074362",
    //   }
    //   const w = await circuit.calculateWitness(inputs, true);
    //   await circuit.assertOut(w, expOut);
    // });
});
