import {describe} from "mocha";

const path = require("path");
const wasmTester = require("circom_tester").wasm;

// export {};

describe("Test credentialAtomicQuerySigV2.circom", function() {

    this.timeout(600000);

    let circuit;

    before(async () => {
        circuit = await wasmTester(
            path.join(__dirname, "../../circuits/offchain", "credentialAtomicQuerySigV2.circom"),
            {
                output: path.join(__dirname, "circuits", "build"),
                recompile: true,
                reduceConstraints: false,
            },
        );

    });

    after(async () => {
        circuit.release()
    })

    const tests = [
        {desc: "UserID != Subject. UserID out. User nonce = 0. Claim issued on Profile (subject nonce = 999)", inputs: {userGenesisID: "24357338057394103910029868244681596615276666879950910837900400354886746113", nonce: "0", claimSubjectProfileNonce: "999", issuerID: "21443782015371791400876357388364171246290737482854988499085152504070668289", issuerClaim: ["3583233690122716044519380227940806650830", "19933278588808080426688072751524960199355164583837691837234531701178368001", "17568057213828477233507447080689055308823020388972334380526849356111335110900", "0", "30803922965249841627828060170", "0", "0", "0"], issuerClaimNonRevClaimsTreeRoot: "15199473115813230313374914807082214428877572421391930598963399134225175436873", issuerClaimNonRevRevTreeRoot: "0", issuerClaimNonRevRootsTreeRoot: "0", issuerClaimNonRevState: "941468466445458410186775788257959899059193009206256072692441148778367618811", issuerClaimNonRevMtp: ["0", "0", "0", "0", "0", "0", "0", "0", "0", "0", "0", "0", "0", "0", "0", "0", "0", "0", "0", "0", "0", "0", "0", "0", "0", "0", "0", "0", "0", "0", "0", "0"], issuerClaimNonRevMtpAuxHi: "0", issuerClaimNonRevMtpAuxHv: "0", issuerClaimNonRevMtpNoAux: "1", claimSchema: "180410020913331409885634153623124536270", issuerClaimSignatureR8x: "19805918752015476485328376346992718680850873848553270954325444903052772695502", issuerClaimSignatureR8y: "14588215049224473958514808035406742054366301395117040967022773900732779963290", issuerClaimSignatureS: "146558144784465270629834244175162990669843590073679081251405939388024242230", issuerAuthClaim: ["304427537360709784173770334266246861770", "0", "18843627616807347027405965102907494712213509184168391784663804560181782095821", "21769574296201138406688395494914474950554632404504713590270198507141791084591", "17476719578317212277", "0", "0", "0"], issuerAuthClaimMtp: ["0", "0", "0", "0", "0", "0", "0", "0", "0", "0", "0", "0", "0", "0", "0", "0", "0", "0", "0", "0", "0", "0", "0", "0", "0", "0", "0", "0", "0", "0", "0", "0"], issuerAuthClaimNonRevMtp: ["0", "0", "0", "0", "0", "0", "0", "0", "0", "0", "0", "0", "0", "0", "0", "0", "0", "0", "0", "0", "0", "0", "0", "0", "0", "0", "0", "0", "0", "0", "0", "0"], issuerAuthClaimNonRevMtpAuxHi: "0", issuerAuthClaimNonRevMtpAuxHv: "0", issuerAuthClaimNonRevMtpNoAux: "1", issuerAuthClaimsTreeRoot: "15199473115813230313374914807082214428877572421391930598963399134225175436873", issuerAuthRevTreeRoot: "0", issuerAuthRootsTreeRoot: "0", claimPathNotExists: "0", claimPathMtp: ["5559250731000753554753485016695600829384855452867544273344893815961938985436", "20222899544143787877985297439625828822272100269106711904511119118819809140477", "14730426618666280941604039095550905490156541514901979358549599762282042588641", "20497288520738821800886677250569208588689763166335933087499619993954968899866", "3295720551404287572425718873751040314503774617833462052445584373469655789999", "796356776410152646380783209242693344675665178494017735650545708722024766291", "0", "0", "0", "0", "0", "0", "0", "0", "0", "0", "0", "0", "0", "0", "0", "0", "0", "0", "0", "0", "0", "0", "0", "0", "0", "0"], claimPathMtpNoAux: "0", claimPathMtpAuxHi: "0", claimPathMtpAuxHv: "0", claimPathKey: "8566939875427719562376598811066985304309117528846759529734201066483458512800", claimPathValue: "1420070400000000000", operator: 1, slotIndex: 2, timestamp: "1642074362", value: ["1420070400000000000", "0", "0", "0", "0", "0", "0", "0", "0", "0", "0", "0", "0", "0", "0", "0", "0", "0", "0", "0", "0", "0", "0", "0", "0", "0", "0", "0", "0", "0", "0", "0", "0", "0", "0", "0", "0", "0", "0", "0", "0", "0", "0", "0", "0", "0", "0", "0", "0", "0", "0", "0", "0", "0", "0", "0", "0", "0", "0", "0", "0", "0", "0", "0"]}, expOut: {userID: "24357338057394103910029868244681596615276666879950910837900400354886746113", issuerID: "21443782015371791400876357388364171246290737482854988499085152504070668289", issuerAuthState: "941468466445458410186775788257959899059193009206256072692441148778367618811", issuerClaimNonRevState: "941468466445458410186775788257959899059193009206256072692441148778367618811", claimSchema: "180410020913331409885634153623124536270", slotIndex: "2", operator: 1, value: ["1420070400000000000", "0", "0", "0", "0", "0", "0", "0", "0", "0", "0", "0", "0", "0", "0", "0", "0", "0", "0", "0", "0", "0", "0", "0", "0", "0", "0", "0", "0", "0", "0", "0", "0", "0", "0", "0", "0", "0", "0", "0", "0", "0", "0", "0", "0", "0", "0", "0", "0", "0", "0", "0", "0", "0", "0", "0", "0", "0", "0", "0", "0", "0", "0", "0"], timestamp: "1642074362"}},
        {desc: "UserID != Subject. UserProfile out. User nonce = 10. Claim issued on Profile (subject nonce = 0)", inputs: {userGenesisID: "24357338057394103910029868244681596615276666879950910837900400354886746113", nonce: "10", claimSubjectProfileNonce: "0", issuerID: "21443782015371791400876357388364171246290737482854988499085152504070668289", issuerClaim: ["3583233690122716044519380227940806650830", "24357338057394103910029868244681596615276666879950910837900400354886746113", "17568057213828477233507447080689055308823020388972334380526849356111335110900", "0", "30803922965249841627828060170", "0", "0", "0"], issuerClaimNonRevClaimsTreeRoot: "15199473115813230313374914807082214428877572421391930598963399134225175436873", issuerClaimNonRevRevTreeRoot: "0", issuerClaimNonRevRootsTreeRoot: "0", issuerClaimNonRevState: "941468466445458410186775788257959899059193009206256072692441148778367618811", issuerClaimNonRevMtp: ["0", "0", "0", "0", "0", "0", "0", "0", "0", "0", "0", "0", "0", "0", "0", "0", "0", "0", "0", "0", "0", "0", "0", "0", "0", "0", "0", "0", "0", "0", "0", "0"], issuerClaimNonRevMtpAuxHi: "0", issuerClaimNonRevMtpAuxHv: "0", issuerClaimNonRevMtpNoAux: "1", claimSchema: "180410020913331409885634153623124536270", issuerClaimSignatureR8x: "9771064973096917383570841543431960252363794748432081049544282277590383750807", issuerClaimSignatureR8y: "9799558681767385541918499125322674843633009513297543097436624698782028827373", issuerClaimSignatureS: "1439411848250016721565767610304809702981774193445914573559963194724017090874", issuerAuthClaim: ["304427537360709784173770334266246861770", "0", "18843627616807347027405965102907494712213509184168391784663804560181782095821", "21769574296201138406688395494914474950554632404504713590270198507141791084591", "17476719578317212277", "0", "0", "0"], issuerAuthClaimMtp: ["0", "0", "0", "0", "0", "0", "0", "0", "0", "0", "0", "0", "0", "0", "0", "0", "0", "0", "0", "0", "0", "0", "0", "0", "0", "0", "0", "0", "0", "0", "0", "0"], issuerAuthClaimNonRevMtp: ["0", "0", "0", "0", "0", "0", "0", "0", "0", "0", "0", "0", "0", "0", "0", "0", "0", "0", "0", "0", "0", "0", "0", "0", "0", "0", "0", "0", "0", "0", "0", "0"], issuerAuthClaimNonRevMtpAuxHi: "0", issuerAuthClaimNonRevMtpAuxHv: "0", issuerAuthClaimNonRevMtpNoAux: "1", issuerAuthClaimsTreeRoot: "15199473115813230313374914807082214428877572421391930598963399134225175436873", issuerAuthRevTreeRoot: "0", issuerAuthRootsTreeRoot: "0", claimPathNotExists: "0", claimPathMtp: ["5559250731000753554753485016695600829384855452867544273344893815961938985436", "20222899544143787877985297439625828822272100269106711904511119118819809140477", "14730426618666280941604039095550905490156541514901979358549599762282042588641", "20497288520738821800886677250569208588689763166335933087499619993954968899866", "3295720551404287572425718873751040314503774617833462052445584373469655789999", "796356776410152646380783209242693344675665178494017735650545708722024766291", "0", "0", "0", "0", "0", "0", "0", "0", "0", "0", "0", "0", "0", "0", "0", "0", "0", "0", "0", "0", "0", "0", "0", "0", "0", "0"], claimPathMtpNoAux: "0", claimPathMtpAuxHi: "0", claimPathMtpAuxHv: "0", claimPathKey: "8566939875427719562376598811066985304309117528846759529734201066483458512800", claimPathValue: "1420070400000000000", operator: 1, slotIndex: 2, timestamp: "1642074362", value: ["1420070400000000000", "0", "0", "0", "0", "0", "0", "0", "0", "0", "0", "0", "0", "0", "0", "0", "0", "0", "0", "0", "0", "0", "0", "0", "0", "0", "0", "0", "0", "0", "0", "0", "0", "0", "0", "0", "0", "0", "0", "0", "0", "0", "0", "0", "0", "0", "0", "0", "0", "0", "0", "0", "0", "0", "0", "0", "0", "0", "0", "0", "0", "0", "0", "0"]}, expOut: {userID: "16501380676610282756331962130170908325950918404081458092270009074630918145", issuerID: "21443782015371791400876357388364171246290737482854988499085152504070668289", issuerAuthState: "941468466445458410186775788257959899059193009206256072692441148778367618811", issuerClaimNonRevState: "941468466445458410186775788257959899059193009206256072692441148778367618811", claimSchema: "180410020913331409885634153623124536270", slotIndex: "2", operator: 1, value: ["1420070400000000000", "0", "0", "0", "0", "0", "0", "0", "0", "0", "0", "0", "0", "0", "0", "0", "0", "0", "0", "0", "0", "0", "0", "0", "0", "0", "0", "0", "0", "0", "0", "0", "0", "0", "0", "0", "0", "0", "0", "0", "0", "0", "0", "0", "0", "0", "0", "0", "0", "0", "0", "0", "0", "0", "0", "0", "0", "0", "0", "0", "0", "0", "0", "0"], timestamp: "1642074362"}},
        {desc: "UserID == Subject. UserProfile out. User nonce = 10. Claim issued on Profile (subject nonce = 999)", inputs: {userGenesisID: "24357338057394103910029868244681596615276666879950910837900400354886746113", nonce: "10", claimSubjectProfileNonce: "999", issuerID: "21443782015371791400876357388364171246290737482854988499085152504070668289", issuerClaim: ["3583233690122716044519380227940806650830", "19933278588808080426688072751524960199355164583837691837234531701178368001", "17568057213828477233507447080689055308823020388972334380526849356111335110900", "0", "30803922965249841627828060170", "0", "0", "0"], issuerClaimNonRevClaimsTreeRoot: "15199473115813230313374914807082214428877572421391930598963399134225175436873", issuerClaimNonRevRevTreeRoot: "0", issuerClaimNonRevRootsTreeRoot: "0", issuerClaimNonRevState: "941468466445458410186775788257959899059193009206256072692441148778367618811", issuerClaimNonRevMtp: ["0", "0", "0", "0", "0", "0", "0", "0", "0", "0", "0", "0", "0", "0", "0", "0", "0", "0", "0", "0", "0", "0", "0", "0", "0", "0", "0", "0", "0", "0", "0", "0"], issuerClaimNonRevMtpAuxHi: "0", issuerClaimNonRevMtpAuxHv: "0", issuerClaimNonRevMtpNoAux: "1", claimSchema: "180410020913331409885634153623124536270", issuerClaimSignatureR8x: "19805918752015476485328376346992718680850873848553270954325444903052772695502", issuerClaimSignatureR8y: "14588215049224473958514808035406742054366301395117040967022773900732779963290", issuerClaimSignatureS: "146558144784465270629834244175162990669843590073679081251405939388024242230", issuerAuthClaim: ["304427537360709784173770334266246861770", "0", "18843627616807347027405965102907494712213509184168391784663804560181782095821", "21769574296201138406688395494914474950554632404504713590270198507141791084591", "17476719578317212277", "0", "0", "0"], issuerAuthClaimMtp: ["0", "0", "0", "0", "0", "0", "0", "0", "0", "0", "0", "0", "0", "0", "0", "0", "0", "0", "0", "0", "0", "0", "0", "0", "0", "0", "0", "0", "0", "0", "0", "0"], issuerAuthClaimNonRevMtp: ["0", "0", "0", "0", "0", "0", "0", "0", "0", "0", "0", "0", "0", "0", "0", "0", "0", "0", "0", "0", "0", "0", "0", "0", "0", "0", "0", "0", "0", "0", "0", "0"], issuerAuthClaimNonRevMtpAuxHi: "0", issuerAuthClaimNonRevMtpAuxHv: "0", issuerAuthClaimNonRevMtpNoAux: "1", issuerAuthClaimsTreeRoot: "15199473115813230313374914807082214428877572421391930598963399134225175436873", issuerAuthRevTreeRoot: "0", issuerAuthRootsTreeRoot: "0", claimPathNotExists: "0", claimPathMtp: ["5559250731000753554753485016695600829384855452867544273344893815961938985436", "20222899544143787877985297439625828822272100269106711904511119118819809140477", "14730426618666280941604039095550905490156541514901979358549599762282042588641", "20497288520738821800886677250569208588689763166335933087499619993954968899866", "3295720551404287572425718873751040314503774617833462052445584373469655789999", "796356776410152646380783209242693344675665178494017735650545708722024766291", "0", "0", "0", "0", "0", "0", "0", "0", "0", "0", "0", "0", "0", "0", "0", "0", "0", "0", "0", "0", "0", "0", "0", "0", "0", "0"], claimPathMtpNoAux: "0", claimPathMtpAuxHi: "0", claimPathMtpAuxHv: "0", claimPathKey: "8566939875427719562376598811066985304309117528846759529734201066483458512800", claimPathValue: "1420070400000000000", operator: 1, slotIndex: 2, timestamp: "1642074362", value: ["1420070400000000000", "0", "0", "0", "0", "0", "0", "0", "0", "0", "0", "0", "0", "0", "0", "0", "0", "0", "0", "0", "0", "0", "0", "0", "0", "0", "0", "0", "0", "0", "0", "0", "0", "0", "0", "0", "0", "0", "0", "0", "0", "0", "0", "0", "0", "0", "0", "0", "0", "0", "0", "0", "0", "0", "0", "0", "0", "0", "0", "0", "0", "0", "0", "0"]}, expOut: {userID: "16501380676610282756331962130170908325950918404081458092270009074630918145", issuerID: "21443782015371791400876357388364171246290737482854988499085152504070668289", issuerAuthState: "941468466445458410186775788257959899059193009206256072692441148778367618811", issuerClaimNonRevState: "941468466445458410186775788257959899059193009206256072692441148778367618811", claimSchema: "180410020913331409885634153623124536270", slotIndex: "2", operator: 1, value: ["1420070400000000000", "0", "0", "0", "0", "0", "0", "0", "0", "0", "0", "0", "0", "0", "0", "0", "0", "0", "0", "0", "0", "0", "0", "0", "0", "0", "0", "0", "0", "0", "0", "0", "0", "0", "0", "0", "0", "0", "0", "0", "0", "0", "0", "0", "0", "0", "0", "0", "0", "0", "0", "0", "0", "0", "0", "0", "0", "0", "0", "0", "0", "0", "0", "0"], timestamp: "1642074362"}},
        {desc: "UserID = Subject. UserID out. User nonce = 0, Subject nonce = 0 claim issued on userID", inputs: {userGenesisID: "24357338057394103910029868244681596615276666879950910837900400354886746113", nonce: "0", claimSubjectProfileNonce: "0", issuerID: "21443782015371791400876357388364171246290737482854988499085152504070668289", issuerClaim: ["3583233690122716044519380227940806650830", "24357338057394103910029868244681596615276666879950910837900400354886746113", "17568057213828477233507447080689055308823020388972334380526849356111335110900", "0", "30803922965249841627828060170", "0", "0", "0"], issuerClaimNonRevClaimsTreeRoot: "15199473115813230313374914807082214428877572421391930598963399134225175436873", issuerClaimNonRevRevTreeRoot: "0", issuerClaimNonRevRootsTreeRoot: "0", issuerClaimNonRevState: "941468466445458410186775788257959899059193009206256072692441148778367618811", issuerClaimNonRevMtp: ["0", "0", "0", "0", "0", "0", "0", "0", "0", "0", "0", "0", "0", "0", "0", "0", "0", "0", "0", "0", "0", "0", "0", "0", "0", "0", "0", "0", "0", "0", "0", "0"], issuerClaimNonRevMtpAuxHi: "0", issuerClaimNonRevMtpAuxHv: "0", issuerClaimNonRevMtpNoAux: "1", claimSchema: "180410020913331409885634153623124536270", issuerClaimSignatureR8x: "9771064973096917383570841543431960252363794748432081049544282277590383750807", issuerClaimSignatureR8y: "9799558681767385541918499125322674843633009513297543097436624698782028827373", issuerClaimSignatureS: "1439411848250016721565767610304809702981774193445914573559963194724017090874", issuerAuthClaim: ["304427537360709784173770334266246861770", "0", "18843627616807347027405965102907494712213509184168391784663804560181782095821", "21769574296201138406688395494914474950554632404504713590270198507141791084591", "17476719578317212277", "0", "0", "0"], issuerAuthClaimMtp: ["0", "0", "0", "0", "0", "0", "0", "0", "0", "0", "0", "0", "0", "0", "0", "0", "0", "0", "0", "0", "0", "0", "0", "0", "0", "0", "0", "0", "0", "0", "0", "0"], issuerAuthClaimNonRevMtp: ["0", "0", "0", "0", "0", "0", "0", "0", "0", "0", "0", "0", "0", "0", "0", "0", "0", "0", "0", "0", "0", "0", "0", "0", "0", "0", "0", "0", "0", "0", "0", "0"], issuerAuthClaimNonRevMtpAuxHi: "0", issuerAuthClaimNonRevMtpAuxHv: "0", issuerAuthClaimNonRevMtpNoAux: "1", issuerAuthClaimsTreeRoot: "15199473115813230313374914807082214428877572421391930598963399134225175436873", issuerAuthRevTreeRoot: "0", issuerAuthRootsTreeRoot: "0", claimPathNotExists: "0", claimPathMtp: ["5559250731000753554753485016695600829384855452867544273344893815961938985436", "20222899544143787877985297439625828822272100269106711904511119118819809140477", "14730426618666280941604039095550905490156541514901979358549599762282042588641", "20497288520738821800886677250569208588689763166335933087499619993954968899866", "3295720551404287572425718873751040314503774617833462052445584373469655789999", "796356776410152646380783209242693344675665178494017735650545708722024766291", "0", "0", "0", "0", "0", "0", "0", "0", "0", "0", "0", "0", "0", "0", "0", "0", "0", "0", "0", "0", "0", "0", "0", "0", "0", "0"], claimPathMtpNoAux: "0", claimPathMtpAuxHi: "0", claimPathMtpAuxHv: "0", claimPathKey: "8566939875427719562376598811066985304309117528846759529734201066483458512800", claimPathValue: "1420070400000000000", operator: 1, slotIndex: 2, timestamp: "1642074362", value: ["1420070400000000000", "0", "0", "0", "0", "0", "0", "0", "0", "0", "0", "0", "0", "0", "0", "0", "0", "0", "0", "0", "0", "0", "0", "0", "0", "0", "0", "0", "0", "0", "0", "0", "0", "0", "0", "0", "0", "0", "0", "0", "0", "0", "0", "0", "0", "0", "0", "0", "0", "0", "0", "0", "0", "0", "0", "0", "0", "0", "0", "0", "0", "0", "0", "0"]}, expOut: {userID: "24357338057394103910029868244681596615276666879950910837900400354886746113", issuerID: "21443782015371791400876357388364171246290737482854988499085152504070668289", issuerAuthState: "941468466445458410186775788257959899059193009206256072692441148778367618811", issuerClaimNonRevState: "941468466445458410186775788257959899059193009206256072692441148778367618811", claimSchema: "180410020913331409885634153623124536270", slotIndex: "2", operator: 1, value: ["1420070400000000000", "0", "0", "0", "0", "0", "0", "0", "0", "0", "0", "0", "0", "0", "0", "0", "0", "0", "0", "0", "0", "0", "0", "0", "0", "0", "0", "0", "0", "0", "0", "0", "0", "0", "0", "0", "0", "0", "0", "0", "0", "0", "0", "0", "0", "0", "0", "0", "0", "0", "0", "0", "0", "0", "0", "0", "0", "0", "0", "0", "0", "0", "0", "0"], timestamp: "1642074362"}},
    ];

    tests.forEach(({desc, inputs, expOut}) => {
        it(`${desc}`, async function() {
            const w = await circuit.calculateWitness(inputs, true);
            await circuit.assertOut(w, expOut);
            await circuit.checkConstraints(w);
        });
    });

});
